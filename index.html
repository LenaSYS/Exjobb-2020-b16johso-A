<!DOCTYPE html>
<html>
	<head>
		<title>WebGL 3D Model Viewer Using babylon.js</title>

		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<script src="babylon.js"></script>
		<script src="babylon.objFileLoader.js"></script>

		<style>
			body {
				overflow: hidden;
				margin: 0;
				padding: 0;
				background: hsl(0, 0%, 10%);
			}

			p {
				margin: 0;
				padding: 0;
			}

			canvas {
				height: 100%;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<script>
			var container;
			var canvas;
			var engine;
			var camera, controls, scene, renderer;
			var lighting, ambient, keyLight, fillLight, backLight;

			init();

			function init() {
				container = document.createElement("div");
				document.body.appendChild(container);
				canvas = document.createElement("canvas");
				container.appendChild(canvas);

				engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine

				/* Scene */
				scene = new BABYLON.Scene(engine);
				// Set background color
				scene.clearColor = new BABYLON.Color3(0.1, 0.1, 0.1);
				// Makes sure OBJ isn't flipped
				scene.useRightHandedSystem = true;

				/* Camera */
				camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, Math.PI / 2, 3, new BABYLON.Vector3(0, 0, 0), scene);
				camera.attachControl(canvas, true);
				camera.inertia = 0.75;
				camera.angularSensibilityX = 500;
				camera.angularSensibilityY = 500;
				// Disable zooming
				camera.lowerRadiusLimit = camera.radius;
				camera.upperRadiusLimit = camera.radius;

				lighting = false;

				ambient = new BABYLON.HemisphericLight("HemiLight", new BABYLON.Vector3(0, 1, 0), scene);
				ambient.intensity = 2.0;
				ambient.shadowEnabled = false;

				keyLight = new BABYLON.DirectionalLight("DirectionalLight", new BABYLON.Vector3(100, 0, -100), scene);
				keyLight.diffuse = new BABYLON.Color3.FromInts(255, 191, 128);
				keyLight.intensity = 1.0;

				fillLight = new BABYLON.DirectionalLight("DirectionalLight", new BABYLON.Vector3(-100, 0, -100), scene);
				fillLight.diffuse = new BABYLON.Color3.FromInts(128, 128, 255);
				fillLight.intensity = 0.75;

				backLight = new BABYLON.DirectionalLight("DirectionalLight", new BABYLON.Vector3(-100, 0, 100), scene);
				backLight.diffuse = new BABYLON.Color3.FromInts(255, 255, 255);
				backLight.intensity = 2.0;

				//Initially disable lights
				keyLight.setEnabled(false);
				fillLight.setEnabled(false);
				backLight.setEnabled(false);

				/* Model */
				//var model = BABYLON.SceneLoader.Append("./assets/", "female-croupier-2013-03-26.obj", scene, function(scene) {
				//console.log(model);
				//model.
				//});

				var model = BABYLON.SceneLoader.ImportMesh("", "./assets/", "female-croupier-2013-03-26.obj", scene, function(mesh) {
					console.log("Import successful");
				});

				/* Renderer */
				engine.runRenderLoop(function() {
					scene.render();
				});

				/* Events */

				window.addEventListener("resize", onWindowResize, false);
				window.addEventListener("keydown", onKeyboardEvent, false);
			}

			function onWindowResize() {
				engine.resize();
			}

			function onKeyboardEvent(e) {
				if (e.code === "KeyL") {
					lighting = !lighting;

					if (lighting) {
						ambient.intensity = 0.5;
						keyLight.setEnabled(true);
						fillLight.setEnabled(true);
						backLight.setEnabled(true);
					} else {
						ambient.intensity = 2.0;
						keyLight.setEnabled(false);
						fillLight.setEnabled(false);
						backLight.setEnabled(false);
					}
				}
			}
		</script>
	</body>
</html>
